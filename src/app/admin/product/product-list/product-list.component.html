<!-- ACTION BUTTONS -->
<div class="mt-5 d-flex justify-content-between">
      <button type="button" class="btn btn-primary" routerLink="../register">
        Adicionar Produto
      </button>
      <button type="button"
        class="btn btn-outline-primary end-0"
        data-bs-toggle="modal"
        data-bs-target="#filterModal">
        Filtro
        <i class="bi bi-funnel"></i>
      </button>
</div>

<!-- MODAL -->
<div class="modal fade" id="filterModal" tabindex="-1" aria-labelledby="filterModalLabel" aria-hidden="true">
  <form class="modal-dialog modal-dialog-centered" [formGroup]="formGroup" (ngSubmit)="onSubmit()">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="exampleModalLabel">Filtro</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="mb-3">
          <label for="name" class="form-label">Nome:</label>
          <input type="text" class="form-control" id="name" formControlName="name" required>
        </div>
        <div class="mb-3">
          <div class="form-check">
            <input class="form-check-input" type="radio" id="exampleRadios1" formControlName="status" value="active">
            <label class="form-check-label" for="exampleRadios1">
              Ativo
            </label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="radio" id="exampleRadios2" formControlName="status" value="inactive">
            <label class="form-check-label" for="exampleRadios2">
              Inativo
            </label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="radio"
              id="exampleRadios3" formControlName="status" value="both" checked>
            <label class="form-check-label" for="exampleRadios3">
              Ambos
            </label>
          </div>
        </div>
        <div class="mb-3">
          <label for="categoryId" class="form-label">Categoria:</label>
          <select class="form-select" formControlName="categoryId" id="categoryId" >
            <option value="0">Escolha uma categoria</option>
            @for(cat of categories; track cat.id) {
              <option value="{{cat.id}}">{{ cat.name }}</option>
            }
          </select>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" (click)="cleanFilter()" class="btn btn-secondary" data-bs-dismiss="modal">Limpar</button>
        <button type="submit" class="btn btn-primary" data-bs-dismiss="modal">
          Aplicar
        </button>
      </div>
    </div>
  </form>
</div>

<!-- ######### TABLE #########  -->
<div class="mt-3 table-responsive">
  @if (displayProducts.length == 0) {
    <div class="">
      <p class="">Nenhum produto encontrado!</p>
    </div>
  } @else {
    <table class="table table-striped caption-top">
      <caption>Produtos:</caption>
      <thead>
        <tr>
          <th scope="col">Nome</th>
          <th scope="col">Ativo</th>
          <th scope="col">Categoria</th>
          <th scope="col">Criado Em</th>
          <th scope="col">Atualizado Em</th>
          <th colspan="3" scope="col"></th>
        </tr>
      </thead>
      <tbody>
        @for(product of displayProducts; track product.id) {
          <tr>
            <td>{{ product.name }}</td>
            <td>
              @if(product.active) {
                <i class="bi bi-check-circle-fill text-success"></i>
              } @else {
                <i class="bi bi-x-circle-fill text-danger"></i>
              }
            </td>
            <td>{{ product.categoryName }}</td>
            <td>{{ product.createdAt | date: 'd/M/yy, H:mm' }}</td>
            <td>{{ product.updatedAt| date: 'd/M/yy, H:mm' }}</td>
            <td>
              <button
                [routerLink]="['..', 'register', product.id]"
              class="btn btn-sm btn-outline-success">
                Detalhes
              </button>
            </td>
            <td>
              <button class="btn btn-sm"
                [ngClass]="product.active ? 'btn-outline-danger' : 'btn-outline-primary'"
                (click)="toggleActive(product)">
                @if(product.active) {
                  Inativar
                } @else {
                  Ativar
                }
              </button>
            </td>
            <td>
              <button class="btn btn-sm btn-outline-danger" (click)="delete(product)">
                Excluir
              </button>
            </td>
          </tr>
        }
      </tbody>
    </table>
  }
</div>

